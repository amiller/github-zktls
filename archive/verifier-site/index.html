<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHub zkTLS - Twitter Login Verifier</title>
  <style>
    * { box-sizing: border-box; }
    body { font-family: system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; background: #0d1117; color: #c9d1d9; }
    h1 { color: #58a6ff; }
    .card { background: #161b22; border: 1px solid #30363d; border-radius: 8px; padding: 1.5rem; margin: 1rem 0; }
    input, button { padding: 0.75rem 1rem; border-radius: 6px; border: 1px solid #30363d; background: #0d1117; color: #c9d1d9; font-size: 1rem; }
    input { width: 100%; margin-bottom: 1rem; }
    button { background: #238636; border-color: #238636; cursor: pointer; }
    button:hover { background: #2ea043; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .proof-image { max-width: 100%; border-radius: 8px; margin: 1rem 0; }
    .status { padding: 1rem; border-radius: 6px; margin: 1rem 0; }
    .status.success { background: #238636; }
    .status.error { background: #da3633; }
    .status.pending { background: #1f6feb; }
    pre { background: #0d1117; padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.9rem; }
    code { color: #79c0ff; }
    .hidden { display: none; }
    a { color: #58a6ff; }
  </style>
</head>
<body>
  <h1>üîê GitHub zkTLS</h1>
  <p>Prove you own a Twitter account using GitHub Actions as the trust anchor.</p>

  <div class="card">
    <h2>Verify a Proof</h2>
    <input type="text" id="runUrl" placeholder="GitHub Actions run URL (e.g., https://github.com/user/repo/actions/runs/12345)">
    <input type="text" id="ghToken" placeholder="GitHub token (optional, for private repos)">
    <button onclick="verifyProof()">Verify Proof</button>
  </div>

  <div id="result" class="hidden">
    <div id="statusBox" class="status"></div>
    <div class="card" id="proofCard">
      <h3>Proof Details</h3>
      <div id="proofDetails"></div>
      <img id="proofImage" class="proof-image hidden">
    </div>
  </div>

  <div class="card">
    <h2>How it works</h2>
    <ol>
      <li><strong>Extract cookies</strong> from your browser (one-time laptop setup)</li>
      <li><strong>Store as GitHub secret</strong> in your repo</li>
      <li><strong>Run the workflow</strong> - browser container captures authenticated screenshot</li>
      <li><strong>Verifier checks</strong> the public workflow logs and artifact</li>
    </ol>
    <p>The proof is verifiable because GitHub Actions provides tamper-evident logs and attestation.</p>
  </div>

  <div class="card">
    <h2>CLI Verification</h2>
    <pre><code># Download and verify a proof
gh run download &lt;run-id&gt; -n twitter-proof
open proof/screenshot.png
cat proof/certificate.json</code></pre>
  </div>

  <script>
    async function verifyProof() {
      const runUrl = document.getElementById('runUrl').value.trim();
      const token = document.getElementById('ghToken').value.trim();
      const result = document.getElementById('result');
      const statusBox = document.getElementById('statusBox');
      const proofDetails = document.getElementById('proofDetails');
      const proofImage = document.getElementById('proofImage');

      result.classList.remove('hidden');
      statusBox.className = 'status pending';
      statusBox.textContent = 'Verifying...';
      proofImage.classList.add('hidden');

      // Parse run URL
      const match = runUrl.match(/github\.com\/([^/]+)\/([^/]+)\/actions\/runs\/(\d+)/);
      if (!match) {
        statusBox.className = 'status error';
        statusBox.textContent = 'Invalid GitHub Actions run URL';
        return;
      }

      const [, owner, repo, runId] = match;
      const headers = token ? { Authorization: `Bearer ${token}` } : {};

      try {
        // Fetch run details
        const runRes = await fetch(`https://api.github.com/repos/${owner}/${repo}/actions/runs/${runId}`, { headers });
        if (!runRes.ok) throw new Error(`Failed to fetch run: ${runRes.status}`);
        const run = await runRes.json();

        // Fetch artifacts
        const artifactsRes = await fetch(`https://api.github.com/repos/${owner}/${repo}/actions/runs/${runId}/artifacts`, { headers });
        const artifacts = await artifactsRes.json();
        const proofArtifact = artifacts.artifacts?.find(a => a.name === 'twitter-proof');

        proofDetails.innerHTML = `
          <p><strong>Repository:</strong> ${owner}/${repo}</p>
          <p><strong>Run ID:</strong> ${runId}</p>
          <p><strong>Status:</strong> ${run.conclusion || run.status}</p>
          <p><strong>Triggered:</strong> ${new Date(run.created_at).toLocaleString()}</p>
          <p><strong>Workflow:</strong> ${run.name}</p>
          ${proofArtifact ? `<p><strong>Artifact:</strong> ${proofArtifact.name} (${(proofArtifact.size_in_bytes/1024).toFixed(1)} KB)</p>` : '<p><strong>Artifact:</strong> Not found (may need token)</p>'}
          <p><a href="${runUrl}" target="_blank">View on GitHub ‚Üí</a></p>
        `;

        if (run.conclusion === 'success') {
          statusBox.className = 'status success';
          statusBox.textContent = '‚úì Proof verified - workflow completed successfully';

          // Try to fetch artifact (requires token for download)
          if (proofArtifact && token) {
            const dlRes = await fetch(proofArtifact.archive_download_url, { headers });
            if (dlRes.ok) {
              // GitHub returns a zip, would need to unzip client-side
              // For now, just note that artifact exists
              proofDetails.innerHTML += '<p><em>Use CLI to download screenshot: <code>gh run download ' + runId + ' -n twitter-proof</code></em></p>';
            }
          }
        } else if (run.status === 'in_progress' || run.status === 'queued') {
          statusBox.className = 'status pending';
          statusBox.textContent = '‚è≥ Workflow still running...';
        } else {
          statusBox.className = 'status error';
          statusBox.textContent = '‚úó Workflow failed or cancelled';
        }

      } catch (err) {
        statusBox.className = 'status error';
        statusBox.textContent = `Error: ${err.message}`;
      }
    }

    // Auto-fill from URL hash
    if (location.hash) {
      document.getElementById('runUrl').value = decodeURIComponent(location.hash.slice(1));
    }
  </script>
</body>
</html>
