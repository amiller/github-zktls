# Session Notes: 2026-02-03 - ZK GitHub Attestation Research

## Goal
Make GitHub Actions proofs verifiable on-chain via ZKP, enabling trustless NFT issuance.

## Completed This Session

### 1. Sample Attestation Captured
- Added `actions/attest-build-provenance@v2` to `attestation-test.yml` workflow
- Ran workflow, downloaded Sigstore bundle via GitHub API
- Saved to `docs/examples/sample-attestation-bundle.json`
- Analyzed certificate structure in `docs/examples/attestation-analysis.md`

**Key findings:**
- Signature: ECDSA P-256 (leaf cert)
- Certificate issuer: ECDSA P-384 (Fulcio intermediate)
- OIDC claims in X.509 extensions (OID `1.3.6.1.4.1.57264.1.*`)
- Contains: repo, workflow path, commit SHA, runner environment, run URL

### 2. zkEmail Repos Cloned
```
refs/zk-email-verify/  - Circom version (original)
refs/zkemail-noir/     - Noir version (what we'll adapt)
```

### 3. Noir Toolchain Setup
- Installed `nargo 1.0.0-beta.5` (required by zkemail-noir)
- Successfully compiled `verify_email_2048_bit_dkim` example
- Compiled circuit at: `refs/zkemail-noir/examples/verify_email_2048_bit_dkim/target/`

## Architecture Comparison

| zkEmail | Our Project |
|---------|-------------|
| RSA DKIM signature | ECDSA P-256 Sigstore signature |
| Email headers | DSSE envelope |
| DNS public key | Fulcio certificate chain |
| Email body hash | Artifact hash (sha256) |
| Selector/domain | Repository/workflow |

## Key Files to Reference

**zkEmail Noir:**
- `refs/zkemail-noir/lib/src/dkim.nr` - RSA signature verification
- `refs/zkemail-noir/js/src/index.ts` - Input generation from emails
- `refs/zkemail-noir/examples/verify_email_2048_bit_dkim/` - Full example

**Our docs:**
- `docs/zk-github-attestation-plan.md` - Implementation plan
- `docs/examples/attestation-analysis.md` - Certificate structure analysis
- `docs/examples/sample-attestation-bundle.json` - Real attestation data

## Next Steps

1. **Get Fulcio intermediate CA public key** - Need to hardcode or fetch from TUF
2. **Build TypeScript input generator** - Parse Sigstore bundle â†’ circuit witness
3. **Build Noir circuit:**
   - Use `ecdsa_secp256r1::verify_signature` (native Noir)
   - Parse DSSE envelope (compute PAE encoding)
   - Extract OIDC claims from certificate
4. **Solidity verifier** - Deploy Groth16/UltraPlonk verifier

## Commands Reference

```bash
# Noir version
noirup -v 1.0.0-beta.5
~/.nargo/bin/nargo --version

# Compile zkEmail example
cd refs/zkemail-noir/examples/verify_email_2048_bit_dkim
~/.nargo/bin/nargo compile

# Get attestation for an artifact
gh api /repos/amiller/github-zktls/attestations/sha256:$(sha256sum proof.tar | cut -d' ' -f1)
```

## TODO
- [ ] Fix browser-container Docker to use prebuilt image (wastes CI time)
- [ ] Get Fulcio intermediate CA public key
- [ ] Create `zk-github-attestation/` directory with Noir circuit
- [ ] TypeScript witness generator for Sigstore bundles
